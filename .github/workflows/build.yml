name: Build and create ZIP
run-name: Generate javascript, ui and schema to publish
on: [push, pull_request]
jobs:
  check:
    runs-on: ubuntu-latest
    steps:
      - name: Install dependencies
        run: |
          sudo apt -q update
          sudo apt -q install --no-install-recommends npm
      - name: Check out repository code
        uses: actions/checkout@v3
      - name: Setup environment
        run: |
          cd ${{github.workspace}} || exit 1
          npm --silent ci
      - name: Check TypeScript
        run: |
          cd ${{github.workspace}} || exit 1
          npx eslint ${{github.workspace}}/src/**/*.ts
  build:
    runs-on: ubuntu-latest
    steps:
      - name: Install dependencies
        run: |
          sudo apt -q update
          sudo apt -q install --no-install-recommends npm blueprint-compiler libglib2.0-0 bash gnome-shell libgtk-4-bin libgtk-4-common libgtk-4-dev libadwaita-1-0 libadwaita-1-dev
      - name: Check out repository code
        uses: actions/checkout@v3
      - name: Ubuntu specific workarounds
        run: |
          # sed -i -E 's#(blueprint-compiler .*)#\1 || true#g' ${{github.workspace}}/build.sh
          sudo cp ${{github.workspace}}.github/workflows/Adw-1.typelib /usr/lib64/girepository-1.0/
      - name: Run build script
        run: /usr/bin/env bash ${{github.workspace}}/build.sh
      - uses: actions/upload-artifact@v3
        with:
          name: randomwallpaper@iflow.space.shell-extension.zip
          path: ${{github.workspace}}/randomwallpaper@iflow.space
