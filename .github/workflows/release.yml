name: Build and create ZIP
run-name: Generate javascript, ui and schema to publish
on: [push, pull_request]
jobs:
  build:
   runs-on: ubuntu-latest
   steps:
    - name: Install dependencies
      run: |
        sudo apt -q update
        sudo apt -q install --no-install-recommends npm node-typescript blueprint-compiler zip libglib2.0-0 bash eslint gnome-shell libgtk-4-bin libgtk-4-common libgtk-4-dev libadwaita-1-0 libadwaita-1-dev
    - name: Check out repository code
      uses: actions/checkout@v3
    - name: Ubuntu specific workarounds
      run: |
        sed -i -E 's#(blueprint-compiler .*)#\1 || true#g' ${{github.workspace}}/build.sh
        cd ${{github.workspace}}
        npm install --save-dev --silent mkdirp &>/dev/null
    - name: Run build script
      run: /usr/bin/env bash ${{github.workspace}}/build.sh
    - uses: actions/upload-artifact@v3
      with:
        name: randomwallpaper@iflow.space.shell-extension.zip
        path: ${{github.workspace}}/randomwallpaper@iflow.space.shell-extension.zip
